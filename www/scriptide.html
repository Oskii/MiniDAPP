<html>

<head>
	
	<!--   The MINIMA MiFi Javascript Library -->
	<script type="text/javascript" src="./js/minima.js"></script>
		
</head>

<body>

<script type="text/javascript">
	//Wait for the page to load..
	window.addEventListener("load", function(){
		//Listen for Minima Events
		window.addEventListener('MinimaEvent', function(evt) {
			//Deal with each message type
	 		if(evt.detail.event == "connected"){
		 		//Connected..	
	 		}
	    });
		//Initialise MiFi
		Minima.init();
		
		//Load cached if available..
		loadScript();
	});

	//Clean the script to make it easy to use in commands..
	function cleanScript(){
		var txt = document.getElementById("scriptarea").value.trim();
		
		//Store it..
		window.localStorage.setItem('ScriptIDE',txt);
		
		//Now remove the comments
		var nocomm = txt.replace(/\n/g," ");
		nocomm =  nocomm.replace(/\/\*.*\*\//g, " ");
		nocomm =  nocomm.replace(/\s+/g, " ").trim();
		
		//Clean it..
		Minima.cmd("cleanscript \""+nocomm+"\"",function(resp){
			console.log(resp);
			var json = JSON.parse(resp);
			
			var brkscr = json.response.parse.replace(/\n/g,"<br>");
			
			if(json.response.parseok){
				document.getElementById("parse").innerHTML = "PARSE OK<br>"+brkscr;	
			}else{
				document.getElementById("parse").innerHTML = "PARSE FAIL<br>"+brkscr;
			}
			document.getElementById("parse").scrollTop = 0;
			
			document.getElementById("clean").innerHTML = json.response.clean;
			document.getElementById("clean").scrollTop = 0;
		});
	}
	
	function saveScript(){
		var sel = document.getElementById("scripts").selectedIndex;
		var save = document.getElementById("scriptarea").value;
		
	    window.localStorage.setItem('ScriptIDE'+sel,save);
	}
	
	var prevsel = 0;
	function loadScript(){
		//Load cached if available..
		var sel = document.getElementById("scripts").selectedIndex;
		var txt = window.localStorage.getItem('ScriptIDE'+sel);
		
		//Save the OLD
		var save = document.getElementById("scriptarea").value;
		window.localStorage.setItem('ScriptIDE'+prevsel,save);
		prevsel = sel;
		
		//Load the NEW
		if(txt !== null){
			document.getElementById("scriptarea").value = txt;
		}else{
			document.getElementById("scriptarea").value = "";
		}
		
		document.getElementById("parse").innerHTML = "";
		document.getElementById("clean").innerHTML = "";
	}
	
	
</script>

<center>
<br>
<h3>Minima Script IDE</h3>
<br>

<table>
<tr>
	<td colspan=2>PREVSTATE - comma seperated list of previous state state number:value <br><textarea placeholder='0:0xFF , 34:123' style='resize: none;width: 800px;' rows=1 id='prevstate' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td colspan=2>STATE - comma seperated list of state number:value <br><textarea style='resize: none;width: 800px;' rows=1 id='state' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td colspan=2>SIGNATURES - comma separated list of signatures<br><textarea placeholder='0x3A5D322E1F3562ABDDF6FB23E120E233BEADD695E38A2012DF349B26A040CBAA , 0x2ADF94A41D1885514226F6E76CFAA889762E22152A79AA36B66BF1EACA670983' style='resize: none;width: 800px;' rows=1 id='sigs' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td colspan=2><br>SCRIPT - /* .. */ comments are supported and will be removed automatically<br>
	<textarea style='resize: none;width: 800px;height: 360px;' id='scriptarea' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td align=left>
		<select id="scripts" onchange="loadScript();">
		  <option value="1">SCRIPT_1</option>
		  <option value="2">SCRIPT_2</option>
		  <option value="3">SCRIPT_3</option>
		  <option value="4">SCRIPT_4</option>
		  <option value="5">SCRIPT_5</option>
		  <option value="6">SCRIPT_6</option>
		  <option value="7">SCRIPT_7</option>
		  <option value="8">SCRIPT_8</option>
		</select>
	<!-- <button onclick='loadScript();'>LOAD</button>
		<button onclick='saveScript();'>SAVE</button>  -->	
	</td>
	
	<td align=right>
	    <button onclick='document.getElementById("scriptarea").value = "";'>CLEAR</button>
		<button onclick='cleanScript();'>PARSE SCRIPT</button>
	</td>
</tr>

<tr>
	<td colspan=2><br>PARSE RESULTS<div id='parse' style='overflow-y: auto;text-align:left;width:800px;height:200px;background-color:#CCCCCC;color:#000000;'></div></td>
</tr>

<tr>
	<td colspan=2><br>CLEAN SCRIPT<div id='clean' style='overflow-y: auto;text-align:left;width:800px;height:120px;background-color:#CCCCCC;color:#000000;'></div></td>
</tr>

</table>

<br><br>
 
<br><br><a href='index.html'>HOME</a>
</center>

</body>

</html>