<html>

<head>
	
	<!--   The MINIMA MiFi Javascript Library -->
	<script type="text/javascript" src="./js/minima.js"></script>
		
</head>

<body>

<script type="text/javascript">
	//Wait for the page to load..
	window.addEventListener("load", function(){
		//Listen for Minima Events
		window.addEventListener('MinimaEvent', function(evt) {
			//Deal with each message type
	 		if(evt.detail.event == "connected"){
		 		//Connected..	
	 		}
	    });
		//Initialise MiFi
		Minima.init();
		
		//Load cached if available..
		loadScript();
	});

	//Clean the script to make it easy to use in commands..
	function cleanScript(){
		var txt = document.getElementById("scriptarea").value.trim();
		
		if(document.getElementById("autosave").checked){
			saveScript();	
		}
		
		//small touch..
		//var nocomm = txt.replace(/\n/g," ");
		//nocomm =  nocomm.replace(/\/\*.*\*\//g, " ");
		//nocomm =  nocomm.replace(/\s+/g, " ").trim();
		var nocomm = txt.replace(/\n/g," ");
		
		//Clean it..
		Minima.cmd("cleanscript \""+nocomm+"\"",function(resp){
			var json = JSON.parse(resp);
			
			var brkscr = json.response.parse.replace(/\n/g,"<br>");
			
			if(json.response.parseok){
				document.getElementById("parse").innerHTML = "PARSE OK<br>"+brkscr;	
			}else{
				document.getElementById("parse").innerHTML = "PARSE FAIL<br>"+brkscr;
			}
			document.getElementById("parse").scrollTop = 0;
			
			document.getElementById("clean").innerHTML = json.response.clean;
			document.getElementById("clean").scrollTop = 0;
		});
	}
	
	function saveScript(){
		var sel = document.getElementById("scripts").selectedIndex;
		var save = document.getElementById("scriptarea").value;
		
	    window.localStorage.setItem('ScriptIDE'+sel,save);
	}
	
	var prevsel = 0;
	function loadScript(){
		//Load cached if available..
		var sel = document.getElementById("scripts").selectedIndex;
		var txt = window.localStorage.getItem('ScriptIDE'+sel);
		
		//Save the OLD
		if(document.getElementById("autosave").checked){
			var save = document.getElementById("scriptarea").value;
			window.localStorage.setItem('ScriptIDE'+prevsel,save);
		}
		prevsel = sel;
		
		//Load the NEW
		if(txt !== null){
			document.getElementById("scriptarea").value = txt;
		}else{
			document.getElementById("scriptarea").value = "";
		}
		
		document.getElementById("parse").innerHTML = "";
		document.getElementById("clean").innerHTML = "";
	}
	
	function addOutput(){
		var table = document.getElementById("outputtable");
		var rows  = table.getElementsByTagName("tr")
		var len   = rows.length;
		
		var row = table.insertRow(len);
		
		var output  = row.insertCell(0);
		var address = row.insertCell(1);
		var amount  = row.insertCell(2);
		var tokenid = row.insertCell(3);
		
		//Get the data..
		
		
		//Data..
		output.id = "table_output_"+len;
		output.innerHTML = "NEW CELL"+len;
		
		address.id = "table_address_"+len;
		address.innerHTML = "NEW CELL"+len;
	}
	
	function deleteOutput(){
		var table = document.getElementById("outputtable");
		var rows  = table.getElementsByTagName("tr")
		var len   = rows.length;
		
		if(len>2){
			table.deleteRow(len-1);	
		}
	}
	
</script>

<center>
<br>
<h3>Minima Script IDE</h3>
<br>

<table border=0>
<tr>
	<td colspan=2><b>STATE</b> - comma seperated list of state number:value<br>
	<textarea placeholder='0:0xFF , 34:123' style='resize: none;width: 950px;' rows=1 id='state' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td colspan=2><b>PREVSTATE</b> - comma seperated list of previous state state number:value<br>
	<textarea style='resize: none;width: 950px;' rows=1 id='prevstate' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td colspan=2><b>SIGNATURES</b> - comma separated list of public keys (can be shorter 0xFF for debugging)<br>
	<textarea placeholder='0XFF, 0x123, 0x3A5D322E1F3562ABDDF6FB23E120E233BEADD695E38A2012DF349B26A040CBAA' style='resize: none;width: 950px;' rows=1 id='sigs' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td colspan=2><br><b>GLOBALS</b> - the predefined variables every script has access to<br>
	<table style='background-color:#CCCCCC;font-size:12px;font-family:monospace;width:950px;'>
		<tr> 
			<td align=right>@BLKNUM : </td>  <td align=left><input type=text id="globblknum" value=0></td>
		    <td align=right>@INBLKNUM : </td>  <td align=left><input type=text id="globinblknum" value=0></td>
		    <td align=right>@INPUT : </td>  <td align=left><input type=text id="globinput" value=0></td>
		</tr>
		<tr> 
			<td align=right>@ADDRESS : </td>  <td align=left><input type=text id="globaddress" value="0x00"></td>
		    <td align=right>@AMOUNT : </td>  <td align=left><input type=text id="globamount" value=0></td>
		    <td align=right>@TOKENID : </td>  <td align=left><input type=text id="globtokenid" value="0x00"></td>
		</tr>
		<tr> 
			<td align=right>@COINID : </td>  <td align=left><input type=text id="globcoinid" value="0x00"></td>
		    <td align=right>@SCRIPT : </td>  <td align=left><input type=text id="globscript" value=""></td>
		    <td align=right>&nbsp;</td>  <td align=left>&nbsp;</td>
		</tr>
		<tr> 
			<td align=right>@TOTIN : </td>  <td align=left><input type=text id="globtotin" value=1></td>
		    <td align=right>@TOTOUT : </td>  <td align=left><input type=text id="globtotout" value=0></td>
		    <td align=right>&nbsp;</td>  <td align=left>&nbsp;</td>
		</tr>
	</table>
	</td>
</tr>

<tr>
	<td colspan=2><br><b>OUTPUTS</b> - outputs that exist in the transaction<br>
	
	<table id="outputtable" style='font-size:12px;font-family:monospace;'>
		<tr>
			<th align=left>OUTPUT</th>
			<th align=left>ADDRESS</th>
			<th align=left>AMOUNT</th>
			<th align=left>TOKENID</th>
		</tr>
		
		<tr>
			<td><input type='text' name='output_num' value=0 size=10></td>
			<td><input type='text' name='output_address' value="0xFF"></td>
			<td><input type='text' name='output_amount' value=0 size=10></td>
			<td><input type='text' name='output_tokenid' value="0x00"></td>
			<td><button onclick='addOutput();'>ADD</button>&nbsp;<button onclick='deleteOutput();'>DELETE</button> </td>
		</tr>
		
	</table>

	</td>
<tr>
	<td colspan=2><br><b>SCRIPT</b> - /* .. */ comments are supported and will be removed automagically<br>
	<textarea style='resize: none;width: 950px;height: 360px;' id='scriptarea' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td align=left>
		<select id="scripts" onchange="loadScript();">
		  <option value="1">SCRIPT_1</option>
		  <option value="2">SCRIPT_2</option>
		  <option value="3">SCRIPT_3</option>
		  <option value="4">SCRIPT_4</option>
		  <option value="5">SCRIPT_5</option>
		  <option value="6">SCRIPT_6</option>
		  <option value="7">SCRIPT_7</option>
		  <option value="8">SCRIPT_8</option>
		</select>
		<input type="checkbox" id="autosave" name='autosave'> <label for="autosave">AUTOSAVE</label>
		&nbsp;
		&nbsp;
		<button onclick='loadScript();'>LOAD</button>
		<button onclick='saveScript();'>SAVE</button>
	</td>
	
	<td align=right>
	    <!-- <button onclick='document.getElementById("scriptarea").value = "";'>CLEAR</button> -->
		<button onclick='cleanScript();'>PARSE SCRIPT</button>
	</td>
</tr>

<tr>
	<td colspan=2><br>CLEAN SCRIPT<div id='clean' style='font-size:12px;font-family:monospace;overflow-y: auto;text-align:left;width:950px;height:80px;background-color:#CCCCCC;color:#000000;'></div></td>
</tr>

<tr>
	<td colspan=2><br>RUN PARSE RESULTS<div id='parse' style='font-size:12px;font-family:monospace;overflow-y: auto;text-align:left;width:950px;height:200px;background-color:#CCCCCC;color:#000000;'></div></td>
</tr>

</table>

<br><br>
 
<br><br><a href='index.html'>HOME</a>
</center>

</body>

</html>