<html>

<head>
	
	<!--   The MINIMA MiFi Javascript Library -->
	<script type="text/javascript" src="./js/minima.js"></script>
		
</head>

<body>

<script type="text/javascript">
	//Wait for the page to load..
	window.addEventListener("load", function(){
		//Listen for Minima Events
		window.addEventListener('MinimaEvent', function(evt) {
			//Deal with each message type
	 		if(evt.detail.event == "connected"){
		 		//Connected..	
	 		}
	    });
		//Initialise MiFi
		Minima.init();
		
		//Load cached if available..
		var txt = window.localStorage.getItem('ScriptIDE');
		if(txt !== null){
			document.getElementById("scriptarea").value = txt;
		}
	});

	//Clean the script to make it easy to use in commands..
	function cleanScript(){
		var txt = document.getElementById("scriptarea").value.trim();
		
		//Store it..
		window.localStorage.setItem('ScriptIDE',txt);
		
		//Now remove the comments
		var nocomm = txt.replace(/\n/g," ");
		nocomm =  nocomm.replace(/\/\*.*\*\//g, " ");
		nocomm =  nocomm.replace(/\s+/g, " ").trim();
		
		//Clean it..
		Minima.cmd("cleanscript \""+nocomm+"\"",function(resp){
			console.log(resp);
			var json = JSON.parse(resp);
			
			var brkscr = json.response.parse.replace(/\n/g,"<br>");
			
			if(json.response.parseok){
				document.getElementById("parse").innerHTML = "PARSE OK<br>"+brkscr;	
			}else{
				document.getElementById("parse").innerHTML = "PARSE FAIL<br>"+brkscr;
			}
			document.getElementById("parse").scrollTop = 0;
			
			document.getElementById("clean").innerHTML = json.response.clean;
			document.getElementById("clean").scrollTop = 0;
		});
	}
	
	function saveScript(){
	    var save = document.getElementById("scriptarea").value;
		window.localStorage.setItem('ScriptIDE',save);
	}
	
	function loadScript(){
		//Load cached if available..
		var txt = window.localStorage.getItem('ScriptIDE');
		if(txt !== null){
			document.getElementById("scriptarea").value = txt;
		}else{
			alert("No saved script found");	
		}
	}
	
	
</script>

<center>
<br>
<h3>Minima Script IDE</h3>
<br>

<table>

<tr>
	<td colspan=2>You can write your script in here. /* .. */ Comments are supported and will be removed.</td>
</tr>

<tr>
	<td colspan=2><textarea style='width: 800px;height: 360px;' id='scriptarea' spellcheck="false" ></textarea></td>
</tr>

<tr>
	<td align=left>
		<button onclick='loadScript();'>LOAD SCRIPT</button>
		<button onclick='saveScript();'>SAVE SCRIPT</button>
	</td>
	
	<td align=right>
	    <button onclick='document.getElementById("scriptarea").value = "";'>CLEAR</button>
		<button onclick='cleanScript();'>PARSE SCRIPT</button>
	</td>
</tr>

<tr>
	<td colspan=2><br>PARSE RESULTS<div id='parse' style='overflow-y: auto;text-align:left;width:800px;height:200px;background-color:#CCCCCC;color:#000000;'></div></td>
</tr>

<tr>
	<td colspan=2><br>CLEAN SCRIPT<div id='clean' style='overflow-y: auto;text-align:left;width:800px;height:120px;background-color:#CCCCCC;color:#000000;'></div></td>
</tr>

</table>

<br><br>
 
<br><br><a href='index.html'>HOME</a>
</center>

</body>

</html>