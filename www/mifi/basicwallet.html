<html>

<head>
	<!--   The MINIMA MiFi Javascript Library -->
	<script type="text/javascript" src="./minidapps/minima.js"></script>
</head>

<body>

<script type="text/javascript">

	//Send the amount specified to the address
	function send(){
		var amount  = document.getElementById("amount").value;
		var address = document.getElementById("address").value;
		
		//Do It!
		var sendcmd = "send "+amount+" "+address;
		Minima.cmd(sendcmd, function(resp){
			//And set the block
			var json = JSON.parse(resp);
			
			if(json.status == true){
				alert("Funds Sent!");
				
				//Blank them
				document.getElementById("amount").value = "";
				document.getElementById("address").value = "";
				
			}else{
				alert(json.error);
			}
		});
	}

	//Create a new address
	function newAddress(){
		Minima.cmd("newaddress", function(resp){
			var json = JSON.parse(resp);
			document.getElementById("addressdiv").innerHTML = "<b>"+json.response.address.miniaddress+"</b>";
		});
	}

	//Wait for the page to load..
	window.addEventListener("load", function(){
	    
		//Listen for Minima Events
		window.addEventListener('MinimaEvent', function(evt) {
			//Deal with each message type
	 		if(evt.detail.event == "connected"){
	 			document.getElementById("blockdiv").innerHTML = "Block : "+Minima.block;
	 			
	 			//Get an address
	 			newAddress();
	 			
	 		}else if(evt.detail.event == "newblock"){
	 			document.getElementById("blockdiv").innerHTML = "Block : "+Minima.block;
	 			
	 		}else if(evt.detail.event == "newbalance"){
	 			
	 			//Set the Balance..
				var bal     = evt.detail.info.balance[0].confirmed;
				var balun   = evt.detail.info.balance[0].unconfirmed;
				var mempool = evt.detail.info.balance[0].mempool;
				
				//Is there unconfirmed money coming..
				if(balun !== "0" || mempool !== "0"){
					document.getElementById("balancediv").innerHTML = "Balance : "+bal+" / "+balun+" / "+mempool;	
				}else{
					document.getElementById("balancediv").innerHTML = "Balance : "+bal;
				}
	 		}
	    });
		
		//Initialise MiFi
		Minima.init();
	});
	
</script>

<center>
<br>
<h3>Basic Wallet</h3>
<br>
<br>
<br>

<table width="400">
	<tr>
		<td width=200 colspan=2><div id="blockdiv">0</div></td> 
	</tr>
	
	<tr>
		<td width=200><div id="balancediv">0</div></td> <td><button onclick="Minima.cmd('gimme50');alert('50 Testnet Mini on their way!!');">Gimme50</button></td>
	</tr>
	
	<tr>
		<td width=200>Address : </td> <td><button onclick="newAddress();">New Address</button></td>
	</tr>
	<tr>
		<td colspan=2><div id="addressdiv" style="font-size:12px;">..</div></td> 
	</tr>
	
	<tr>
		<td colspan=2>&nbsp;</td>
	</tr>
	
	<tr>
		<td>Amount : </td> <td> <input type='text' id='amount'></td>
	</tr>
	
	<tr>
		<td>Address : </td> <td> <input type='text' id='address'></td>
	</tr>
	
	<tr>
		<td colspan=2> <button onclick='send();return false;'>SEND</button> </td>
	</tr>
	
	
</table>


</center>

</body>

</html>