(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"0lCN":function(e,n,t){"use strict";t.d(n,"a",function(){return l});var o=t("rnMS"),i=t("rux5"),r=t("tyNb"),a=t("TEn/"),s=t("ofXK"),c=t("fXoL");let l=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(n){return new(n||e)},providers:[{provide:"_storeService",useClass:i.a}],imports:[[s.b,a.y,r.j,o.b.forRoot()]]}),e})()},GvLF:function(e,n,t){"use strict";t.r(n),t.d(n,"RewardsPageModule",function(){return L});var o=t("0lCN"),i=t("ofXK"),r=t("3Pt+"),a=t("TEn/"),s=t("tyNb"),c=t("mrSG"),l=t("QSgb"),d=t("Kmpd"),g=t("fXoL"),b=t("rux5"),u=t("KNWA"),f=t("Q+GK"),p=t("LLDH");function m(e,n){if(1&e&&(g.Lb(0,"ion-row",6),g.Lb(1,"ion-col",7),g.nc(2),g.Kb(),g.Kb()),2&e){const e=g.Vb();g.yb(2),g.pc(" ",e.status," ")}}const h=function(){return{color:"var(--ion-color-primary"}},y=function(){return{color:"var(--ion-color-success)"}};function v(e,n){if(1&e&&(g.Lb(0,"ion-col",13),g.Lb(1,"p",14),g.nc(2),g.Kb(),g.Kb()),2&e){const e=g.Vb().$implicit;g.yb(1),g.ac("ngStyle","Node Running"===e.reason?g.cc(2,h):g.cc(3,y)),g.yb(1),g.pc(" ",e.reason," ")}}const w=function(){return{color:"var(--ion-color-success"}};function _(e,n){if(1&e&&(g.Lb(0,"ion-col",13),g.Lb(1,"p",14),g.nc(2),g.Kb(),g.Kb()),2&e){const e=g.Vb().$implicit;g.yb(1),g.ac("ngStyle","Welcome"===e.reason?g.cc(2,w):g.cc(3,y)),g.yb(1),g.pc(" ",e.reason," ")}}const P=function(){return{color:"#660066"}};function C(e,n){if(1&e&&(g.Lb(0,"ion-col",13),g.Lb(1,"p",14),g.nc(2),g.Kb(),g.Kb()),2&e){const e=g.Vb().$implicit;g.yb(1),g.ac("ngStyle","Node Running"!==e.reason&&"Welcome"!==e.reason?g.cc(2,P):g.cc(3,y)),g.yb(1),g.pc(" ",e.reason," ")}}function M(e,n){if(1&e&&(g.Lb(0,"ion-row",9),g.Lb(1,"ion-col",10),g.Lb(2,"p"),g.nc(3),g.Kb(),g.Kb(),g.lc(4,v,3,4,"ion-col",11),g.lc(5,_,3,4,"ion-col",11),g.lc(6,C,3,4,"ion-col",11),g.Lb(7,"ion-col",12),g.Lb(8,"p"),g.nc(9),g.Wb(10,"date"),g.Kb(),g.Kb(),g.Kb()),2&e){const e=n.$implicit;g.yb(3),g.pc(" ",e.amount," "),g.yb(1),g.ac("ngIf","Node Running"===e.reason),g.yb(1),g.ac("ngIf","Welcome"===e.reason),g.yb(1),g.ac("ngIf","Node Running"!==e.reason&&"Welcome"!==e.reason),g.yb(3),g.pc(" ",g.Xb(10,5,e.date_created,"MMM d H:mm")," ")}}function O(e,n){if(1&e&&(g.Lb(0,"div"),g.lc(1,M,11,8,"ion-row",8),g.Kb()),2&e){const e=g.Vb();g.yb(1),g.ac("ngForOf",e.rewardList)}}const k=[{path:"",component:(()=>{class e{constructor(e,n){this._storeService=e,this._directus=n,this.status="No rewards available yet.",this.totalClaimed=new l.Decimal(0),this.rewardList=[]}ionViewWillEnter(){this._storeService.removeTheirInactivityFileOnLogin(),this.$user=this._storeService.data.subscribe(e=>{this.user=e,this.fetchUserRewards(this.user.refID,this.user.loginData.access_token)}),this.getPubKey(this.user)}ionViewWillLeave(){this.$user.unsubscribe()}fetchUserRewards(e,n){if(this.status="Fetching your rewards...",!e||!n)return console.log(""),void(this.status="Fetching rewards failed");this._directus.fetchRewards(e,n).then(e=>((null==e?void 0:e.ok)||(this.status="Fetching rewards from server failed, please check with a Minima admin."),e.json())).then(e=>{(null==e?void 0:e.errors)&&(null==e?void 0:e.errors.length)>0?(this.status=`Something went wrong, ${e.errors[0].message}.  Please check with a Minima admin.`,console.log(null==e?void 0:e.errors)):(this.rewardList=e,this.totalClaimed=new l.Decimal(0),this.rewardList.forEach(e=>{this.totalClaimed=new l.Decimal(e.amount).add(this.totalClaimed)}))})}byDescDate(e,n){return n.date_created.localeCompare(e.date_created)}getPubKey(e){return Object(c.a)(this,void 0,void 0,function*(){const n=yield this._directus.getKey(e.refID,e.loginData.access_token);try{if(!n.ok)throw new Error("IncentiveCash: https://incentivedb.minima.global/custom/utils/getKey failed.");{const t=yield n.json();if(null==t?void 0:t.publickeys)(yield this.checkPubKey(e,t))&&this.postAKey(e);else if(t.errors)throw new Error("IncentiveCash: Failed to fetch publicKey")}}catch(t){d.Minima.log(t)}})}checkPubKey(e,n){return Object(c.a)(this,void 0,void 0,function*(){return new Promise((t,o)=>Object(c.a)(this,void 0,void 0,function*(){var i;if(null==n?void 0:n.publickeys)if(0===(null==n?void 0:n.publickeys.length))t(!0),localStorage.setItem("isLogged","true");else{let o=yield this.fetchCurrentNodeKeys(),r=n.publickeys;const a=o.filter(e=>r.includes(e.publickey));if(0===(null==a?void 0:a.length))localStorage.setItem("isLogged","true"),t(!0);else{let n=e;n.pKey=null===(i=a[0])||void 0===i?void 0:i.publickey,this._storeService.saveUserKey(a[0].publickey),this._storeService.data.next(n),t(!1)}}else o("Failed to check for publicKey match")}))})}fetchCurrentNodeKeys(){return new Promise(e=>{d.Minima.cmd("keys",n=>{if(n.status){let t=[];n.response.publickeys.forEach(e=>{t.push(e)}),e(t||[])}})})}generatePubKey(){return new Promise(e=>{d.Minima.cmd("keys new",n=>{var t;n.status?e(null===(t=n.response)||void 0===t?void 0:t.key.publickey):d.Minima.log("Failed to generate publickey")})})}generateNewAddress(){return new Promise(e=>{d.Minima.cmd("newaddress",n=>{var t;n.status?e(null===(t=n.response)||void 0===t?void 0:t.address.hexaddress):d.Minima.log("Failed to generate address")})})}postAKey(e){return Object(c.a)(this,void 0,void 0,function*(){try{const n=yield this.generateNewAddress(),t=yield this.generatePubKey();this._storeService.saveUserKey(t);const o={userid:e.refID,publickey:t,address:n},i=yield this._directus.postAKey(o,e.loginData.access_token);if(!(null==i?void 0:i.ok))throw new Error("IncentiveCash: https://incentivedb.minima.global/custom/minima/key failed,User prohibited to post another key to server, there is already a key on board.  User trying to login with another node!");{const n=yield i.json();if("OK"!==(null==n?void 0:n.result))throw new Error("IncentiveCash: failed to post a key and wallet address!");{d.Minima.log("A key & wallet address has been posted!");const n=e;n.pKey=o.publickey,this._storeService.data.next(n)}}}catch(n){d.Minima.log(n)}})}}return e.\u0275fac=function(n){return new(n||e)(g.Ib(b.a),g.Ib(u.a))},e.\u0275cmp=g.Cb({type:e,selectors:[["app-rewards"]],decls:6,vars:8,consts:[[3,"$total","$actionPageTitle","$rewardspage"],[3,"fullscreen"],[1,"table","ion-no-padding","animate__animated","animate__fadeIn"],["class","ion-no-padding",4,"ngIf"],[4,"ngIf"],[3,"$total","$page"],[1,"ion-no-padding"],[1,"empty-list","ion-no-padding","ion-text-center"],["class","table-content ion-no-margin",4,"ngFor","ngForOf"],[1,"table-content","ion-no-margin"],[1,"ion-text-left","ion-no-padding","manrope-bold"],["class","ion-text-left ion-no-padding",4,"ngIf"],[1,"ion-text-right","ion-no-padding"],[1,"ion-text-left","ion-no-padding"],[3,"ngStyle"]],template:function(e,n){1&e&&(g.Jb(0,"custom-header",0),g.Lb(1,"ion-content",1),g.Lb(2,"ion-grid",2),g.lc(3,m,3,1,"ion-row",3),g.lc(4,O,2,1,"div",4),g.Kb(),g.Kb(),g.Jb(5,"custom-footer",5)),2&e&&(g.ac("$total",n.totalClaimed)("$actionPageTitle","Claimed Rewards")("$rewardspage",!0),g.yb(1),g.ac("fullscreen",!0),g.yb(2),g.ac("ngIf",n.rewardList&&0===n.rewardList.length),g.yb(1),g.ac("ngIf",n.rewardList&&n.rewardList.length>0),g.yb(1),g.ac("$total",n.totalClaimed)("$page","rewards"))},directives:[f.a,a.h,a.j,i.k,p.a,a.t,a.g,i.j,i.l],pipes:[i.d],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}ion-grid.table[_ngcontent-%COMP%]{margin-top:15px}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]{padding-left:27px;padding-right:27px}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-chip.missed-collection[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;padding:0;text-align:center;background:transparent;background-color:initial}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-chip.missed-collection[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{text-decoration:underline;color:var(--ion-color-secondary)}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;font-variant-numeric:tabular-nums}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-label.awaiting[_ngcontent-%COMP%]{padding:0;display:flex;text-align:right;background:transparent;background-color:initial;color:var(--ion-color-secondary)}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div.due[_ngcontent-%COMP%]{display:flex;height:100%;flex-direction:column;justify-content:center}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div.due[_ngcontent-%COMP%]   ion-label.remainder-date[_ngcontent-%COMP%]{font-size:12px}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div.block[_ngcontent-%COMP%]{display:flex;height:100%;flex-direction:center;justify-content:center}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div.block[_ngcontent-%COMP%]   ion-label.remainder[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:13px}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]:nth-child(2n){background-color:#f0f0fa;background:#f0f0fa}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]:last-child{margin-bottom:15px}@media only screen and (min-width:992px){ion-grid.table[_ngcontent-%COMP%]   ion-row.header[_ngcontent-%COMP%]{margin-left:110px;margin-right:110px}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-content[_ngcontent-%COMP%]{padding-left:110px;padding-right:110px}ion-grid.table[_ngcontent-%COMP%]   ion-row.table-footer[_ngcontent-%COMP%]{margin-left:110px;margin-right:110px}ion-footer[_ngcontent-%COMP%]   ion-toolbar.table-footer[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   ion-toolbar.page-header[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   ion-toolbar.table-header[_ngcontent-%COMP%]{padding-left:110px;padding-right:110px}}ion-content[_ngcontent-%COMP%]{--offset-bottom:auto!important;--overflow:hidden;overflow:auto}ion-content[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}"]}),e})()}];let x=(()=>{class e{}return e.\u0275mod=g.Gb({type:e}),e.\u0275inj=g.Fb({factory:function(n){return new(n||e)},imports:[[s.j.forChild(k)],s.j]}),e})(),L=(()=>{class e{}return e.\u0275mod=g.Gb({type:e}),e.\u0275inj=g.Fb({factory:function(n){return new(n||e)},imports:[[i.b,r.d,a.y,x,o.a]]}),e})()},LLDH:function(e,n,t){"use strict";t.d(n,"a",function(){return u});var o=t("fXoL"),i=t("rux5"),r=t("TEn/"),a=t("ofXK"),s=t("rnMS"),c=t("tyNb");const l=["pollButton"];function d(e,n){1&e&&(o.Lb(0,"span",11),o.nc(1," \u2014 "),o.Kb())}function g(e,n){if(1&e&&(o.Lb(0,"span",11),o.nc(1),o.Kb()),2&e){const e=o.Vb(2);o.yb(1),o.oc(e.$total)}}function b(e,n){if(1&e&&(o.Lb(0,"ion-toolbar",7),o.Lb(1,"ion-grid",8),o.Lb(2,"ion-row"),o.Lb(3,"ion-col",9),o.nc(4," Total Amount: "),o.lc(5,d,2,0,"span",10),o.lc(6,g,2,1,"span",10),o.Kb(),o.Kb(),o.Kb(),o.Kb()),2&e){const e=o.Vb();o.yb(5),o.ac("ngIf",e.$total.equals(0)),o.yb(1),o.ac("ngIf",e.$total.greaterThan(0))}}let u=(()=>{class e{constructor(e){this._storeService=e}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)(o.Ib(i.a))},e.\u0275cmp=o.Cb({type:e,selectors:[["custom-footer"]],viewQuery:function(e,n){if(1&e&&o.qc(l,!0),2&e){let e;o.ec(e=o.Ub())&&(n.pollButton=e.first)}},inputs:{$page:"$page",$total:"$total"},decls:12,vars:3,consts:[[1,"ion-no-border","ion-no-padding","ion-text-center"],["class","table-footer ion-no-padding",4,"ngIf"],[1,"activity","ion-no-padding","animate__animated","animate__fadeIn","animate__faster"],["tooltip","See all your claimed rewards","positionV","bottom","routerLink","/rewards","slot","start","routerLinkActive","ftr-toolbar-active",3,"arrow"],["color","medium","src","assets/incentiveCashClaimedRewards.svg"],["tooltip","See all your pending rewards","positionV","bottom","routerLink","/cash","slot","start","routerLinkActive","ftr-toolbar-active",3,"arrow"],["color","medium","src","assets/incentiveCashRewardsPending.svg"],[1,"table-footer","ion-no-padding"],[1,"ion-no-padding","animate__animated"],[1,"ion-no-padding"],["id","total",4,"ngIf"],["id","total"]],template:function(e,n){1&e&&(o.Lb(0,"ion-footer",0),o.lc(1,b,7,2,"ion-toolbar",1),o.Lb(2,"ion-toolbar",2),o.Lb(3,"ion-buttons"),o.Lb(4,"ion-tab-button",3),o.Jb(5,"ion-icon",4),o.Lb(6,"ion-label"),o.nc(7,"Claimed Rewards"),o.Kb(),o.Kb(),o.Lb(8,"ion-tab-button",5),o.Jb(9,"ion-icon",6),o.Lb(10,"ion-label"),o.nc(11,"Rewards Pending"),o.Kb(),o.Kb(),o.Kb(),o.Kb(),o.Kb()),2&e&&(o.yb(1),o.ac("ngIf","cash"===n.$page||"rewards"===n.$page),o.yb(3),o.ac("arrow",!0),o.yb(4),o.ac("arrow",!0))},directives:[r.i,a.k,r.x,r.e,r.v,s.a,r.B,c.h,c.i,r.l,r.o,r.j,r.t,r.g],styles:["ion-footer[_ngcontent-%COMP%]   ion-toolbar.table-footer[_ngcontent-%COMP%]{padding-left:27px;padding-right:27px}ion-button.poll-button[_ngcontent-%COMP%]{text-transform:none}@media only screen and (min-width:992px){ion-footer[_ngcontent-%COMP%]   ion-toolbar.table-footer[_ngcontent-%COMP%]{padding-left:110px;padding-right:110px}}span#total[_ngcontent-%COMP%]{color:var(--ion-color-success)}"]}),e})()},ON18:function(e,n,t){"use strict";t.d(n,"a",function(){return l});var o=t("mrSG"),i=t("AytR"),r=t("Kmpd"),a=t("fXoL"),s=t("KNWA"),c=t("rux5");let l=(()=>{class e{constructor(e,n){this._directus=e,this._storeService=n,this.environmentApiURL="",this.environmentApiURL=i.a.api,this.serviceJSPayload()}serviceJSPayload(){this.$payload=this._storeService.tokenId.subscribe(e=>{const n=JSON.stringify(e);try{r.Minima.file.save(n,"tokenid.txt",e=>{if(!e.success)throw new Error("TokenId, ScaleFactor not saved!")})}catch(t){r.Minima.log(t)}})}login(e){return Object(o.a)(this,void 0,void 0,function*(){return localStorage.getItem("kickemoff")&&localStorage.removeItem("kickemoff"),this._directus.post(this.environmentApiURL+"auth/login",e)})}logout(){return Object(o.a)(this,void 0,void 0,function*(){document.getElementById("sign-out-btn").style.opacity="1.0",yield this._storeService.getUserDetailsOnce().then(e=>{const n=e;n.loginData.access_token="",n.loginData.refresh_token="",this._storeService.data.next(n),document.location.reload()})})}firstTime(){return new Promise(e=>{r.Minima.file.load("loggedEmail.txt",n=>{n.success?n.data&&JSON.parse(n.data).true&&e(!0):e(!1)})})}logEmail(e){return new Promise((n,t)=>{r.Minima.cmd("hash 256 "+e.toLowerCase(),e=>{if(e.status)if(e.response.hash){const o=JSON.stringify({email:e.response.hash});r.Minima.file.save(o,"loggedEmail.txt",e=>{e.success?n("Email has been logged..."):t("Failed to log user email.")})}else t("File saving unavailable.")})})}checkForEmailTxtFile(){return new Promise((e,n)=>{r.Minima.file.load("loggedEmail.txt",t=>{t||n("Failed to access file system."),e(!!t.success&&!!t.exists)})})}checkEmail(e){return new Promise((n,t)=>{r.Minima.file.load("loggedEmail.txt",o=>{if(o.success)if(o.exists&&o.data){const i=JSON.parse(o.data);r.Minima.cmd("hash 256 "+e.toLowerCase(),e=>{e.status&&e.response.hash&&(e.response.hash===i.email?n("Welcome back :)"):t("Your IncentiveCash MiniDAPP is linked to a previously used email"))})}else n("File not found.");else t("Failed to find file.")})})}getReferenceId(e){return Object(o.a)(this,void 0,void 0,function*(){const n="https://incentivedb.minima.global/users/me?access_token="+e.access_token;return new Promise((e,t)=>{r.Minima.net.GET(n,n=>{n&&n.result?decodeURIComponent(n.result)?e(decodeURIComponent(n.result)):t("Failed to decode server data!"):t("Server time out!  Please check your internet connection or consult an admin.")})})})}makeSessionStart(){return new Promise(e=>{e(new Date||new Date("foo"))})}makeSessionEnd(e){return new Promise(n=>{let t=(new Date).getTime();n(new Date(t+e.expires)||new Date("foo"))})}updateUserData(e,n){return Object(o.a)(this,void 0,void 0,function*(){let t=yield this.makeSessionStart(),o=yield this.makeSessionEnd(e);return new Promise((i,r)=>{this.getReferenceId(e).then(a=>{let s=JSON.parse(a);const c={email:n,pKey:"",refID:s.data.id,loginData:{access_token:e.access_token,refresh_token:e.refresh_token,expires:e.expires,sessions:{sessionStart:t,sessionEnd:o}}};this._storeService.saveFile(JSON.stringify({uid:c.refID}),"uid.txt").then(()=>{i(c)}).catch(e=>{r(""+e)})}).catch(e=>{r(""+e)})})})}}return e.\u0275fac=function(n){return new(n||e)(a.Pb(s.a),a.Pb(c.a))},e.\u0275prov=a.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);